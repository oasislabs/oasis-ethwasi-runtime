use std::collections::BTreeMap;
use std::sync::Mutex;

use clap::{App, Arg};
use ekiden_common::bytes::H256;
use ekiden_core;
use ekiden_db_trusted::{Database, DatabaseHandle};
use ekiden_di::{Component, KnownComponents};
use ekiden_registry_client;
use ekiden_roothash_client;
use ekiden_scheduler_client;
use ekiden_storage_frontend;
use ethcore::client::BlockId;
use ethcore::encoded;
use hex;

use client::ChainNotify;
use runtime_ethereum;
use state::get_key;

fn from_hex<S: AsRef<str>>(hex: S) -> Vec<u8> {
    hex::decode(hex.as_ref()).unwrap()
}

pub struct MockNotificationHandler {
    headers: Mutex<Vec<encoded::Header>>,
    log_filters: Mutex<Vec<(BlockId, BlockId)>>,
}

impl MockNotificationHandler {
    pub fn new() -> Self {
        Self {
            headers: Mutex::new(vec![]),
            log_filters: Mutex::new(vec![]),
        }
    }

    pub fn get_headers(&self) -> Vec<encoded::Header> {
        let headers = self.headers.lock().unwrap();
        headers.clone()
    }

    pub fn get_log_filters(&self) -> Vec<(BlockId, BlockId)> {
        let filters = self.log_filters.lock().unwrap();
        filters.clone()
    }
}

impl ChainNotify for MockNotificationHandler {
    fn has_heads_subscribers(&self) -> bool {
        true
    }

    fn notify_heads(&self, headers: &[encoded::Header]) {
        let mut existing = self.headers.lock().unwrap();
        for &ref header in headers {
            existing.push(header.clone());
        }
    }

    fn notify_logs(&self, from_block: BlockId, to_block: BlockId) {
        let mut filters = self.log_filters.lock().unwrap();
        filters.push((from_block, to_block));
    }
}

pub fn get_test_runtime_client() -> runtime_ethereum::Client {
    let mut known_components = KnownComponents::new();
    ekiden_core::environment::GrpcEnvironment::register(&mut known_components);
    ekiden_scheduler_client::SchedulerClient::register(&mut known_components);
    ekiden_registry_client::EntityRegistryClient::register(&mut known_components);
    ekiden_roothash_client::RootHashClient::register(&mut known_components);
    ekiden_storage_frontend::StorageClient::register(&mut known_components);

    let args = App::new("testing")
        .arg(
            Arg::with_name("entity-registry-client-host")
                .long("entity-registry-client-host")
                .takes_value(true)
                .default_value("127.0.0.1"),
        )
        .arg(
            Arg::with_name("entity-registry-client-port")
                .long("entity-registry-client-port")
                .takes_value(true)
                .default_value("42261"),
        )
        .arg(
            Arg::with_name("grpc-threads")
                .long("grpc-threads")
                .takes_value(true)
                .default_value("4"),
        )
        .arg(
            Arg::with_name("mr-enclave")
                .long("mr-enclave")
                .takes_value(true)
                .default_value("0000000000000000000000000000000000000000000000000000000000000000"),
        )
        .arg(
            Arg::with_name("roothash-client-host")
                .long("roothash-client-host")
                .takes_value(true)
                .default_value("127.0.0.1"),
        )
        .arg(
            Arg::with_name("roothash-client-port")
                .long("roothash-client-port")
                .takes_value(true)
                .default_value("42261"),
        )
        .arg(
            Arg::with_name("scheduler-client-host")
                .long("scheduler-client-host")
                .takes_value(true)
                .default_value("127.0.0.1"),
        )
        .arg(
            Arg::with_name("scheduler-client-port")
                .long("scheduler-client-port")
                .takes_value(true)
                .default_value("42261"),
        )
        .arg(
            Arg::with_name("storage-client-host")
                .long("storage-client-host")
                .takes_value(true)
                .default_value("127.0.0.1"),
        )
        .arg(
            Arg::with_name("storage-client-port")
                .long("storage-client-port")
                .takes_value(true)
                .default_value("42261"),
        )
        .get_matches();

    let mut container = known_components
        .build_with_arguments(&args)
        .expect("failed to initialize component container");

    contract_client!(runtime_ethereum, args, container)
}

pub struct MockDb {
    map: BTreeMap<Vec<u8>, Vec<u8>>,
}

impl MockDb {
    pub fn new() -> Self {
        Self {
            map: BTreeMap::new(),
        }
    }

    // populate the db with data from TestEvents truffle test (five blocks)
    pub fn populate(&mut self) {
        // insert state (column None)
        self.insert(&get_key(None, &from_hex("24b4c44a2d04ee7203157ddcf4fc2412ca9d91e65c7c7f810d4b239e9994802c")), &from_hex("f9015801b90154f9015180a052a56c186e0a9f1140badd5c37c21d0398aef7f0f99367dfd93d9b76f5b57a2da0ae850c85278f2ebf8a2451cb86bfba03e1f52f1c4d77ed271c8ebd8d58605ae88080a04b88345b35059e65991f1d28b150de18fc517d5eebde2572f44a0198df7db74aa015bbc72879d86f2a3b68e15957a5530d7a3329b82f0d49e592943f4d34761c04a073defcc82eb2b696fd024b28fad1fa4211739420b37d3b06b7a3ba1323c6de53a023b789e09af700ba80a1b2c355eedd4ad916c82718d4feea57a7560b5676b06ba0108a70f2e24b14d319bda2926571073cd1ae204bd5f54f76cec43cfb467c47eaa0759ce67f4df8e4a9865f68f74c41dbfc0963154ccdb507fd46cfbd02032307f5a01b15ac2da4ad0a7817c95d3e1c3c27ac9610e5358c7d6923869041e938ad031da0f0403e480c0bc5ffa96d5d67906735ede7588ea3d75ede4c5b5699e1c9c5d4c080808080"));
        self.insert(&get_key(None, &from_hex("108a70f2e24b14d319bda2926571073cd1ae204bd5f54f76cec43cfb467c47ea")), &from_hex("f87701b874f872a03fd6f25c0e1645272e340c6ef1f5704eac5ed890797b608e9c5df8e599ab1a8bb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("fa73f7d6eb3f880bac7cb778586a04ff9b4d96a0be2c99928a1013cff2877598")), &from_hex("f86e01b86bf869a03407dd89a42cd622fefe2c4fadf754186a3a12c5df8db99d2fefcf908d673c97b846f8440180a084f446cbffd65c496942a14d43fe5057381314e7feb7c64005434b02b2ee88fca07b274e4822c05a41a30ec60b468fc6ea8c128e9c5ca8e8419c1c62e1fb37aaf0"));
        self.insert(&get_key(None, &from_hex("24adb1258d85d5d2e746d976c1aad3e25417499fae3a96f6ff7c4416a3188e75")), &from_hex("f85601b853f8518080808080808080a06f26951b62a25ef4d41b9dfacee697354f3d2ebdb943b9c707ed613d3168866b808080808080a066e3ac040e03405a33c315dacb03b375c58fcad03c7bd95359169d03594f1de280"));
        self.insert(&get_key(None, &from_hex("6f26951b62a25ef4d41b9dfacee697354f3d2ebdb943b9c707ed613d3168866b")), &from_hex("f86e01b86bf869a0204f41eb67eb23e42139410eade1008a90b01a018ce2577fea44262c6fc16ce3b846f8440180a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("84f446cbffd65c496942a14dee09044f52290622213a7fdd2aac84923f89b46b")), &from_hex("f83d01b83af838a120290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e5639594627306090abab3a6e1400e9345bc60c78a8bef57"));
        self.insert(&get_key(None, &from_hex("d34272764655bc1220d2a1959c32efcce63970b7bdac76f4e28fc328cd6bd940")), &from_hex("f9017801b90174f9017180a052a56c186e0a9f1140badd5c37c21d0398aef7f0f99367dfd93d9b76f5b57a2da0ae850c85278f2ebf8a2451cb86bfba03e1f52f1c4d77ed271c8ebd8d58605ae88080a04b88345b35059e65991f1d28b150de18fc517d5eebde2572f44a0198df7db74aa015bbc72879d86f2a3b68e15957a5530d7a3329b82f0d49e592943f4d34761c04a073defcc82eb2b696fd024b28fad1fa4211739420b37d3b06b7a3ba1323c6de53a023b789e09af700ba80a1b2c355eedd4ad916c82718d4feea57a7560b5676b06ba024adb1258d85d5d2e746d976c1aad3e25417499fae3a96f6ff7c4416a3188e75a0759ce67f4df8e4a9865f68f74c41dbfc0963154ccdb507fd46cfbd02032307f5a01b15ac2da4ad0a7817c95d3e1c3c27ac9610e5358c7d6923869041e938ad031da0f0403e480c0bc5ffa96d5d67906735ede7588ea3d75ede4c5b5699e1c9c5d4c0a0fa73f7d6eb3f880bac7cb778586a04ff9b4d96a0be2c99928a1013cff2877598808080"));
        self.insert(&get_key(None, &from_hex("73defcc82eb2b696fd024b28fad1fa4211739420b37d3b06b7a3ba1323c6de53")), &from_hex("f87701b874f872a03246c8b3e4dd83e1b08fd64c850d00eed059c4717876f54921371a44c94bd08eb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("23281e214a789cb8fc465003ebcd130022db675b85b5e0f1f4d731f9cc528556")), &from_hex("f85601b853f8518080808080808080a05b906394743cb1d198bf33b5c947c7768d7da6219955ace95bd23be1d894ac32808080808080a066e3ac040e03405a33c315dacb03b375c58fcad03c7bd95359169d03594f1de280"));
        self.insert(&get_key(None, &from_hex("5b906394743cb1d198bf33b5c947c7768d7da6219955ace95bd23be1d894ac32")), &from_hex("f86e01b86bf869a0204f41eb67eb23e42139410eade1008a90b01a018ce2577fea44262c6fc16ce3b846f8440280a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("ebdeed5a0c7f3eb8d87d8fb1d43e6dc12f5977dcd6854e5382d3dbb820215066")), &from_hex("f9017801b90174f9017180a052a56c186e0a9f1140badd5c37c21d0398aef7f0f99367dfd93d9b76f5b57a2da0ae850c85278f2ebf8a2451cb86bfba03e1f52f1c4d77ed271c8ebd8d58605ae88080a04b88345b35059e65991f1d28b150de18fc517d5eebde2572f44a0198df7db74aa015bbc72879d86f2a3b68e15957a5530d7a3329b82f0d49e592943f4d34761c04a073defcc82eb2b696fd024b28fad1fa4211739420b37d3b06b7a3ba1323c6de53a023b789e09af700ba80a1b2c355eedd4ad916c82718d4feea57a7560b5676b06ba023281e214a789cb8fc465003ebcd130022db675b85b5e0f1f4d731f9cc528556a0759ce67f4df8e4a9865f68f74c41dbfc0963154ccdb507fd46cfbd02032307f5a01b15ac2da4ad0a7817c95d3e1c3c27ac9610e5358c7d6923869041e938ad031da0f0403e480c0bc5ffa96d5d67906735ede7588ea3d75ede4c5b5699e1c9c5d4c0a03b25acba60ac44608415f0c33498f19405d6dbc25efdc62ea286482d05c147fb808080"));
        self.insert(&get_key(None, &from_hex("d442ba0b61a37bddf3d8f87a0ecc921743441f6d6516930bc0b09bab4cbd7ffd")), &from_hex("f86e01b86bf869a0204f41eb67eb23e42139410eade1008a90b01a018ce2577fea44262c6fc16ce3b846f8440380a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("7b16d8581631740cacf4be8c0655b9ef1045b40271200e886bd428d66b1e560f")), &from_hex("f85601b853f8518080808080808080a0d442ba0b61a37bddf3d8f87a0ecc921743441f6d6516930bc0b09bab4cbd7ffd808080808080a066e3ac040e03405a33c315dacb03b375c58fcad03c7bd95359169d03594f1de280"));
        self.insert(&get_key(None, &from_hex("7ca347b8ed2f1d9993d43d7b37c4e943343f98a313dd9084cc909aa2bd932c41")), &from_hex("f9017801b90174f9017180a052a56c186e0a9f1140badd5c37c21d0398aef7f0f99367dfd93d9b76f5b57a2da0ae850c85278f2ebf8a2451cb86bfba03e1f52f1c4d77ed271c8ebd8d58605ae88080a04b88345b35059e65991f1d28b150de18fc517d5eebde2572f44a0198df7db74aa015bbc72879d86f2a3b68e15957a5530d7a3329b82f0d49e592943f4d34761c04a05b38243626198d75d969b06be891abc5bb4de2dbdeedbe28f7f248f7970f7d78a023b789e09af700ba80a1b2c355eedd4ad916c82718d4feea57a7560b5676b06ba07b16d8581631740cacf4be8c0655b9ef1045b40271200e886bd428d66b1e560fa0759ce67f4df8e4a9865f68f74c41dbfc0963154ccdb507fd46cfbd02032307f5a01b15ac2da4ad0a7817c95d3e1c3c27ac9610e5358c7d6923869041e938ad031da0f0403e480c0bc5ffa96d5d67906735ede7588ea3d75ede4c5b5699e1c9c5d4c0a03b25acba60ac44608415f0c33498f19405d6dbc25efdc62ea286482d05c147fb808080"));
        self.insert(&get_key(None, &from_hex("f0403e480c0bc5ffa96d5d67906735ede7588ea3d75ede4c5b5699e1c9c5d4c0")), &from_hex("f87701b874f872a0355381f5fce2f3e495b70e316395fb7e2056198a8656a93470e02331c6faa2eab84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("15bbc72879d86f2a3b68e15957a5530d7a3329b82f0d49e592943f4d34761c04")), &from_hex("f85601b853f85180808080808080a0b664944548c38985cf692ff6ca602b89c7512ba3c551d01c67987d958a387eb580808080a024bb1b16fdaadd54b5721cb1a427dc5ff16340f13481a076b5b3fc546105469d80808080"));
        self.insert(&get_key(None, &from_hex("0568bca3a77203099283ad7193221fda21946a7b1dd4a776fe376d9ffc210f45")), &from_hex("f87701b874f872a0208360fb40f4ba4917b00782e0138c35d184ebad53a2ef3a846b304cd67d9b91b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("07fd6456c3458dc456e0a0ecc4df316b0a5ab0bb82da42b410ee3163cfdf7e72")), &from_hex("f87701b874f872a0202f29e338f08358568ca87b7f6d930642390ff65543e3e41c66b2250bbf3e78b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("120770785cfcb741ef915c183484a946eef84e23529defadde8ef6afebac5107")), &from_hex("f87801b875f873a0209da0425bcb8fbccca3757c4119bf48bed9980bc5ef60acfdc337bd4558d0abb850f84e808a152d02c7e14af6800000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("23b789e09af700ba80a1b2c355eedd4ad916c82718d4feea57a7560b5676b06b")), &from_hex("f87701b874f872a03bb0a8965190f0cb8941429478b21bdb51a16037ac2937a3c87756a0a2a62e1fb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("52a56c186e0a9f1140badd5c37c21d0398aef7f0f99367dfd93d9b76f5b57a2d")), &from_hex("f85601b853f851808080a0120770785cfcb741ef915c183484a946eef84e23529defadde8ef6afebac510780a007fd6456c3458dc456e0a0ecc4df316b0a5ab0bb82da42b410ee3163cfdf7e728080808080808080808080"));
        self.insert(&get_key(None, &from_hex("24bb1b16fdaadd54b5721cb1a427dc5ff16340f13481a076b5b3fc546105469d")), &from_hex("f87701b874f872a02072cd96fb7a7cfeaf6caf7b8954d5cc9325ae0a4a475b9dbdb85d3c4f9736b1b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("42fe932ee340975c2c765f8a45d1e019ad202f2595f6b46b34f4a69a7d6fc2d8")), &from_hex("f87701b874f872a020ab50d1e908c1146ab04f30430ab5244cd9896144fed21696bc5f73c87cc594b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("ae850c85278f2ebf8a2451cb86bfba03e1f52f1c4d77ed271c8ebd8d58605ae8")), &from_hex("f85601b853f851a042fe932ee340975c2c765f8a45d1e019ad202f2595f6b46b34f4a69a7d6fc2d8808080a00568bca3a77203099283ad7193221fda21946a7b1dd4a776fe376d9ffc210f45808080808080808080808080"));
        self.insert(&get_key(None, &from_hex("b664944548c38985cf692ff6ca602b89c7512ba3c551d01c67987d958a387eb5")), &from_hex("f87701b874f872a02078deef11bd639a4ec02a05bd5b100b589d02671789ed1b95c4b2b5d5bddcd0b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("4b88345b35059e65991f1d28b150de18fc517d5eebde2572f44a0198df7db74a")), &from_hex("f87701b874f872a03b954423083e6cc42ca247e8aeb14a9a29d8dce84ca59021b21ad8e487185e56b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("759ce67f4df8e4a9865f68f74c41dbfc0963154ccdb507fd46cfbd02032307f5")), &from_hex("f87701b874f872a03dab320bf997adf800d55080d89425fbbffee284e8f6013028b0bba7381ff39fb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("1b15ac2da4ad0a7817c95d3e1c3c27ac9610e5358c7d6923869041e938ad031d")), &from_hex("f87701b874f872a0316260489ab261235d262ff1bcbdd36f84f55e1c1f0665969ce764a2624a47e2b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("66e3ac040e03405a33c315dacb03b375c58fcad03c7bd95359169d03594f1de2")), &from_hex("f87701b874f872a020d6f25c0e1645272e340c6ef1f5704eac5ed890797b608e9c5df8e599ab1a8bb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("7b274e4822c05a41a30ec60beb7892f2e6289c59832551dcb3f3ad7176509667")), &from_hex("f902fc01b902f8608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630900f01014610067578063445df0ac146100aa5780638da5cb5b146100d5578063fdacd5761461012c575b600080fd5b34801561007357600080fd5b506100a8600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610159565b005b3480156100b657600080fd5b506100bf610241565b6040518082815260200191505060405180910390f35b3480156100e157600080fd5b506100ea610247565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561013857600080fd5b506101576004803603810190808035906020019092919050505061026c565b005b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561023d578190508073ffffffffffffffffffffffffffffffffffffffff1663fdacd5766001546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050600060405180830381600087803b15801561022457600080fd5b505af1158015610238573d6000803e3d6000fd5b505050505b5050565b60015481565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156102c957806001819055505b505600a165627a7a7230582030345ac4501e1f02e6574e06fe0a4f6287f3a062ee80ef55a9af2328379018e50029"));
        self.insert(&get_key(None, &from_hex("82b6b3f9839607d59f01b5a579cf0c45fe3d80cd9813b15a4b66d00b18b075fa")), &from_hex("f85601b853f8518080a0ee70810ffcc71a7dfcd131faa5e0c3025866697abee0b4ca9f85818107a862378080808080808080a0f4984a11f61a2921456141df88de6e1a710d28681b91af794c5a721e47839cd78080808080"));
        self.insert(
            &get_key(
                None,
                &from_hex("f4984a11f61a2921456141df25293a021b373aadc41c16e463b5bd8ecae4a040"),
            ),
            &from_hex(
                "e501a3e2a0310e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf601",
            ),
        );
        self.insert(&get_key(None, &from_hex("ee70810ffcc71a7dfcd131fa0817971a325c7bbf616d0d57b06a4e118acf5ea0")), &from_hex("f83b01b838f7a0390decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e5639594627306090abab3a6e1400e9345bc60c78a8bef57"));
        self.insert(&get_key(None, &from_hex("3b25acba60ac44608415f0c33498f19405d6dbc25efdc62ea286482d05c147fb")), &from_hex("f86e01b86bf869a03407dd89a42cd622fefe2c4fadf754186a3a12c5df8db99d2fefcf908d673c97b846f8440180a082b6b3f9839607d59f01b5a5d438585d94079208479e08c764891f9b95d7496da07b274e4822c05a41a30ec60b468fc6ea8c128e9c5ca8e8419c1c62e1fb37aaf0"));
        self.insert(&get_key(None, &from_hex("86351505023ebc83b40138405806b90969f0fdf9e190faefd5721e3550979241")), &from_hex("f8d701b8d4608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680634d43bec9146044575b600080fd5b348015604f57600080fd5b50606c60048036038101908080359060200190929190505050606e565b005b7f6c2b4666ba8da5a95717621d879a77de725f3d816709b9cbe9f059b8f875e284816040518082815260200191505060405180910390a1505600a165627a7a72305820a5b279645773e5659f8cf96cbb92f57e889b47a336d976ec5eeba94b1a6f0aa00029"));
        self.insert(&get_key(None, &from_hex("39ae37cadc9b3afcaef72c87183252d980b91cf35786ed15b9dc2a595c537a20")), &from_hex("f86e01b86bf869a02046e5509034c1153c24ba3a8863b45bda0344158c630d3c63da1c9c329e4d93b846f8440180a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a086351505023ebc83b4013840d0650d52b3f3b9ec6df3f7d3b6a802a96209dfd2"));
        self.insert(&get_key(None, &from_hex("5b38243626198d75d969b06be891abc5bb4de2dbdeedbe28f7f248f7970f7d78")), &from_hex("f85601b853f85180a039ae37cadc9b3afcaef72c87183252d980b91cf35786ed15b9dc2a595c537a20a00430849fb66c2057d4c95bf8c46d58ebb692ed192a13fea0fd334ec6290336268080808080808080808080808080"));
        self.insert(&get_key(None, &from_hex("0430849fb66c2057d4c95bf8c46d58ebb692ed192a13fea0fd334ec629033626")), &from_hex("f87701b874f872a02046c8b3e4dd83e1b08fd64c850d00eed059c4717876f54921371a44c94bd08eb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));
        self.insert(&get_key(None, &from_hex("b7ad1a9279c967d98ba4dff3b2c0cc5be3d1eb8490636b932b088c35f9fafd5f")), &from_hex("f85601b853f8518080808080808080a09e9fd58d5d1fb33fd9de7f584e236c2d129ffa0af93cb0bbae3199638b28c53e808080808080a066e3ac040e03405a33c315dacb03b375c58fcad03c7bd95359169d03594f1de280"));
        self.insert(&get_key(None, &from_hex("e4ec21e633a2a50925bec371aeec322ad73077d0fad46c51a072bf0759433d25")), &from_hex("f9017801b90174f9017180a052a56c186e0a9f1140badd5c37c21d0398aef7f0f99367dfd93d9b76f5b57a2da0ae850c85278f2ebf8a2451cb86bfba03e1f52f1c4d77ed271c8ebd8d58605ae88080a04b88345b35059e65991f1d28b150de18fc517d5eebde2572f44a0198df7db74aa015bbc72879d86f2a3b68e15957a5530d7a3329b82f0d49e592943f4d34761c04a05b38243626198d75d969b06be891abc5bb4de2dbdeedbe28f7f248f7970f7d78a023b789e09af700ba80a1b2c355eedd4ad916c82718d4feea57a7560b5676b06ba0b7ad1a9279c967d98ba4dff3b2c0cc5be3d1eb8490636b932b088c35f9fafd5fa0759ce67f4df8e4a9865f68f74c41dbfc0963154ccdb507fd46cfbd02032307f5a01b15ac2da4ad0a7817c95d3e1c3c27ac9610e5358c7d6923869041e938ad031da0f0403e480c0bc5ffa96d5d67906735ede7588ea3d75ede4c5b5699e1c9c5d4c0a03b25acba60ac44608415f0c33498f19405d6dbc25efdc62ea286482d05c147fb808080"));
        self.insert(&get_key(None, &from_hex("9e9fd58d5d1fb33fd9de7f584e236c2d129ffa0af93cb0bbae3199638b28c53e")), &from_hex("f86e01b86bf869a0204f41eb67eb23e42139410eade1008a90b01a018ce2577fea44262c6fc16ce3b846f8440480a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"));

        // insert block headers (column 1)
        self.insert(&get_key(Some(1), &from_hex("f39c325375fa2d5381a950850abd9999abd2ff64cd0f184139f5bb5d74afb14e")), &from_hex("f901eaa00000000000000000000000000000000000000000000000000000000000000000a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a024b4c44a2d04ee7203157ddcf4fc2412ca9d91e65c7c7f810d4b239e9994802ca056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000808087100000000000008080a00000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(&get_key(Some(1), &from_hex("d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b")), &from_hex("f901aea0f39c325375fa2d5381a950850abd9999abd2ff64cd0f184139f5bb5d74afb14e8102940000000000000000000000000000000000000000a0d34272764655bc1220d2a1959c32efcce63970b7bdac76f4e28fc328cd6bd940a0e43b2d12f60852db4b75bd5cb2fa562a90edceaa493d4ea97389847e4304244da020ef6a3b7a282b4bf41c7236b2f74bc5aa49b6eebc8fc9873ffaf4682ef6b194b90100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008001871000000000000183043bd68080"));
        self.insert(&get_key(Some(1), &from_hex("17a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f")), &from_hex("f901ada0d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b8102940000000000000000000000000000000000000000a0ebdeed5a0c7f3eb8d87d8fb1d43e6dc12f5977dcd6854e5382d3dbb820215066a0cca30001a8232aca56bf52279d2b586850558ab580017acac0aaed15a23e338aa05834bf566ed3a6417b53d443cd8372255e32169894ef8bfde24b52bd5cf5bc8fb90100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008002871000000000000282a4188080"));
        self.insert(&get_key(Some(1), &from_hex("c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae3")), &from_hex("f901aea017a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f8102940000000000000000000000000000000000000000a07ca347b8ed2f1d9993d43d7b37c4e943343f98a313dd9084cc909aa2bd932c41a0263cf2ae3bc5e5c197fb84b3a22689c07b16d5b429dad64851e8e33a6716c297a0a840aae5490b8083a60081595e85e99cc33703585737c5e730e7b8afe6e29e67b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800387100000000000038301ab8d8080"));
        self.insert(&get_key(Some(1), &from_hex("339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f199")), &from_hex("f901ada0c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae38102940000000000000000000000000000000000000000a0e4ec21e633a2a50925bec371aeec322ad73077d0fad46c51a072bf0759433d25a0c427131c94c7381e3d6ecda31b9b0e87fce1111bb680980366fda3c2ac6b33f0a051f4193609ccbd0d74a7d6b58aa7b8ca66b7925416372ccc21c931400659ab33b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000010000000000000800487100000000000048258c28080"));

        // insert block bodies (column 2)
        self.insert(
            &get_key(
                Some(2),
                &from_hex("f39c325375fa2d5381a950850abd9999abd2ff64cd0f184139f5bb5d74afb14e"),
            ),
            &from_hex("c2c0c0"),
        );
        self.insert(&get_key(Some(2), &from_hex("d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b")), &from_hex("f903adf903a9f903a68080836691b78080b90358608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506102f8806100606000396000f300608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630900f01014610067578063445df0ac146100aa5780638da5cb5b146100d5578063fdacd5761461012c575b600080fd5b34801561007357600080fd5b506100a8600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610159565b005b3480156100b657600080fd5b506100bf610241565b6040518082815260200191505060405180910390f35b3480156100e157600080fd5b506100ea610247565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561013857600080fd5b506101576004803603810190808035906020019092919050505061026c565b005b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561023d578190508073ffffffffffffffffffffffffffffffffffffffff1663fdacd5766001546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050600060405180830381600087803b15801561022457600080fd5b505af1158015610238573d6000803e3d6000fd5b505050505b5050565b60015481565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156102c957806001819055505b505600a165627a7a7230582030345ac4501e1f02e6574e06fe0a4f6287f3a062ee80ef55a9af2328379018e500291ba06029b11b1656a243e2da28883292570d273908f13821e78e9f6bc1b0116fa72ba063796086f074ed5fa2f23289513dee0fe27358f23d285c030d917154e8fe9709c0"));
        self.insert(&get_key(Some(2), &from_hex("17a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f")), &from_hex("f889f886f8840180836691b7948cdaf0cd259887258bc13a92c0a6da92698644c080a4fdacd57600000000000000000000000000000000000000000000000000000000000000011ca0526fdd9936bce0e90e9e226799452e0021a19414174a58c8aff55ca892f39732a07180ae3e93f60fe8c39272079a31847837d078c45cf5527a63e7cf34e3cca9ddc0"));
        self.insert(&get_key(Some(2), &from_hex("c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae3")), &from_hex("f90146f90142f9013f0280836691b78080b8f26080604052348015600f57600080fd5b5060d48061001e6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680634d43bec9146044575b600080fd5b348015604f57600080fd5b50606c60048036038101908080359060200190929190505050606e565b005b7f6c2b4666ba8da5a95717621d879a77de725f3d816709b9cbe9f059b8f875e284816040518082815260200191505060405180910390a1505600a165627a7a72305820a5b279645773e5659f8cf96cbb92f57e889b47a336d976ec5eeba94b1a6f0aa000291ca0e9d3cca71dbc5186e8f5fa9606f019e1d42416724c1c5e1859e3def6d4489611a03787562b017f2ad894328bd7aef14b23c2614dcf0923c8ac89dd76712336ac68c0"));
        self.insert(&get_key(Some(2), &from_hex("339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f199")), &from_hex("f889f886f8840380836691b794345ca3e014aaf5dca488057592ee47305d9b3e1080a44d43bec9000000000000000000000000000000000000000000000000000000000000007b1ba0e8fe702a597a696bb2458a20716737360a0950971f7886de0c2841e09d3db757a04f823c34fef534b19176b88f9bf7fdb319f2d21e86501ef27bdd32dd713eb0e1c0"));

        // insert extra data (column 3)
        self.insert(
            &get_key(Some(3), &from_hex("0100000000")),
            &from_hex("a0f39c325375fa2d5381a950850abd9999abd2ff64cd0f184139f5bb5d74afb14e"),
        );
        self.insert(&get_key(Some(3), &from_hex("04d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b")), &from_hex("f9010cf901090183043bd6b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0"));
        self.insert(&get_key(Some(3), &from_hex("00f39c325375fa2d5381a950850abd9999abd2ff64cd0f184139f5bb5d74afb14e")), &from_hex("f8458080a00000000000000000000000000000000000000000000000000000000000000000e1a0d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b"));
        self.insert(
            &get_key(Some(3), &from_hex("0100000001")),
            &from_hex("a0d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("02eb0dfa279a990b377c988ded8e7a43bc2c59d1022b9ad6c90e4642c163ca9672"),
            ),
            &from_hex("e2a0d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b80"),
        );
        self.insert(&get_key(Some(3), &from_hex("0417a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f")), &from_hex("f9010bf901080182a418b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0"));
        self.insert(&get_key(Some(3), &from_hex("00d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658b")), &from_hex("f8470180a0f39c325375fa2d5381a950850abd9999abd2ff64cd0f184139f5bb5d74afb14ee1a017a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f01c0"));
        self.insert(
            &get_key(Some(3), &from_hex("0100000002")),
            &from_hex("a017a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("02b3e73d3a209209b001c2c52fe2825aac5e56205d98b035638520088cb36ac8b9"),
            ),
            &from_hex("e2a017a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f80"),
        );
        self.insert(&get_key(Some(3), &from_hex("04c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae3")), &from_hex("f9010cf90109018301ab8db9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0"));
        self.insert(&get_key(Some(3), &from_hex("0017a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3f")), &from_hex("f8470280a0d56eee931740bb35eb9bf9f97cfebb66ac51a1d88988c1255b52677b958d658be1a0c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae301c0"));
        self.insert(
            &get_key(Some(3), &from_hex("0100000003")),
            &from_hex("a0c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae3"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("02362bb01b545b7b90dc5b0819d10497c75c833b0ea97173151c2540fae7f9f5b4"),
            ),
            &from_hex("e2a0c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae380"),
        );
        self.insert(&get_key(Some(3), &from_hex("04339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f199")), &from_hex("f90166f90163018258c2b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000010000000000000f85af85894345ca3e014aaf5dca488057592ee47305d9b3e10e1a06c2b4666ba8da5a95717621d879a77de725f3d816709b9cbe9f059b8f875e284a0000000000000000000000000000000000000000000000000000000000000007b"));
        self.insert(&get_key(Some(3), &from_hex("030100000000")), &from_hex("f91030b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000010000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(&get_key(Some(3), &from_hex("030000000000")), &from_hex("f91030b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000010000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(&get_key(Some(3), &from_hex("030200000000")), &from_hex("f91030b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000010000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(
            &get_key(Some(3), &from_hex("62657374")),
            &from_hex("339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f199"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("00339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f199"),
            ),
            &from_hex(
                "e60480a0c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae3c001c0",
            ),
        );
        self.insert(&get_key(Some(3), &from_hex("00c57db28f3a012eb2a783cd1295a0c5e7fcc08565c526c2c86c8355a54ab7aae3")), &from_hex("f8470380a017a7a94ad21879641349b6e90ccd7e42e63551ad81b3fda561cd2df4860fbd3fe1a0339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f19901c0"));
        self.insert(
            &get_key(Some(3), &from_hex("0100000004")),
            &from_hex("a0339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f199"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("02cfb3d83aa4b9c7d9a698e9b8169383c819fbf6200848ae5fcaec25e414295790"),
            ),
            &from_hex("e2a0339ddee2b78be3e53af2b0a3148643973cf0e0fa98e16ab963ee17bf79e6f19980"),
        );
    }
}

impl Database for MockDb {
    fn contains_key(&self, key: &[u8]) -> bool {
        self.map.contains_key(key)
    }

    fn get(&self, key: &[u8]) -> Option<Vec<u8>> {
        self.map.get(key).cloned()
    }

    fn insert(&mut self, key: &[u8], value: &[u8]) -> Option<Vec<u8>> {
        self.map.insert(key.to_vec(), value.to_vec())
    }

    fn remove(&mut self, key: &[u8]) -> Option<Vec<u8>> {
        self.map.remove(key)
    }

    fn clear(&mut self) {
        self.map.clear()
    }

    fn with_encryption<F>(&mut self, _contract_id: H256, _f: F)
    where
        F: FnOnce(&mut DatabaseHandle) -> (),
    {
        unimplemented!();
    }
}
