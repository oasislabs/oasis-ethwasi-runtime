use std::collections::BTreeMap;
use std::sync::{Arc, Mutex};

use clap::{App, Arg};
use ekiden_common::bytes::H256;
use ekiden_core::{self, error::Result, futures::prelude::*};
use ekiden_db_trusted::{Database, DatabaseHandle};
use ekiden_di::{Component, KnownComponents};
use ekiden_keymanager_common::StateKeyType;
use ekiden_registry_client;
use ekiden_roothash_client;
use ekiden_scheduler_client;
use ekiden_storage_base::{InsertOptions, StorageBackend};
use ekiden_storage_dummy::DummyStorageBackend;
use ekiden_storage_frontend;
use ethcore::encoded;
use ethcore::ids::BlockId;
use hex;

use client::ChainNotify;
use runtime_ethereum;
use runtime_ethereum_common::get_key;

fn from_hex<S: AsRef<str>>(hex: S) -> Vec<u8> {
    hex::decode(hex.as_ref()).unwrap()
}

pub struct MockNotificationHandler {
    headers: Mutex<Vec<encoded::Header>>,
    log_notifications: Mutex<Vec<(BlockId, BlockId)>>,
}

impl MockNotificationHandler {
    pub fn new() -> Self {
        Self {
            headers: Mutex::new(vec![]),
            log_notifications: Mutex::new(vec![]),
        }
    }

    pub fn get_notified_headers(&self) -> Vec<encoded::Header> {
        let headers = self.headers.lock().unwrap();
        headers.clone()
    }

    pub fn get_log_notifications(&self) -> Vec<(BlockId, BlockId)> {
        let notifications = self.log_notifications.lock().unwrap();
        notifications.clone()
    }
}

impl ChainNotify for MockNotificationHandler {
    fn has_heads_subscribers(&self) -> bool {
        true
    }

    fn notify_heads(&self, headers: &[encoded::Header]) {
        let mut existing = self.headers.lock().unwrap();
        for &ref header in headers {
            existing.push(header.clone());
        }
    }

    fn notify_logs(&self, from_block: BlockId, to_block: BlockId) {
        let mut notifications = self.log_notifications.lock().unwrap();
        notifications.push((from_block, to_block));
    }
}

pub fn get_test_runtime_client() -> runtime_ethereum::Client {
    let mut known_components = KnownComponents::new();
    ekiden_core::environment::GrpcEnvironment::register(&mut known_components);
    ekiden_core::remote_node::RemoteNodeInfo::register(&mut known_components);
    ekiden_scheduler_client::SchedulerClient::register(&mut known_components);
    ekiden_registry_client::EntityRegistryClient::register(&mut known_components);
    ekiden_roothash_client::RootHashClient::register(&mut known_components);
    ekiden_storage_frontend::StorageClient::register(&mut known_components);
    let args = App::new("testing")
        .arg(
            Arg::with_name("grpc-threads")
                .long("grpc-threads")
                .takes_value(true)
                .default_value("4"),
        )
        .arg(
            Arg::with_name("mr-enclave")
                .long("mr-enclave")
                .takes_value(true)
                .default_value("0000000000000000000000000000000000000000000000000000000000000000"),
        )
        .arg(
            Arg::with_name("node-host")
                .long("node-host")
                .takes_value(true)
                .default_value("127.0.0.1"),
        )
        .arg(
            Arg::with_name("node-port")
                .long("node-port")
                .takes_value(true)
                .default_value("42261"),
        )
        .arg(
            Arg::with_name("storage-client-host")
                .long("storage-client-host")
                .takes_value(true)
                .default_value("127.0.0.1"),
        )
        .arg(
            Arg::with_name("storage-client-port")
                .long("storage-client-port")
                .takes_value(true)
                .default_value("42261"),
        )
        .get_matches();

    let mut container = known_components
        .build_with_arguments(&args)
        .expect("failed to initialize component container");

    runtime_client!(runtime_ethereum, args, container)
}

pub struct MockDb {
    storage: Arc<StorageBackend>,
    map: BTreeMap<Vec<u8>, Vec<u8>>,
}

impl MockDb {
    pub fn new() -> Self {
        Self {
            storage: Arc::new(DummyStorageBackend::new()),
            map: BTreeMap::new(),
        }
    }

    pub fn storage(&self) -> Arc<StorageBackend> {
        self.storage.clone()
    }

    // populate the db with data from TestEvents truffle test (five blocks)
    pub fn populate(&mut self) {
        self.insert(&get_key(Some(1), &from_hex("3546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685ae")), &from_hex("f901e7a00000000000000000000000000000000000000000000000000000000000000000a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a08cc8e7ddb7f47f2ef21260619b0eca5ba9eb637f99557fc12d02b5c8b5b595a9a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421b901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080808401e848008080a00000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(
            &get_key(
                Some(2),
                &from_hex("3546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685ae"),
            ),
            &from_hex("c2c0c0"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("003546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685ae"),
            ),
            &from_hex("e48080a00000000000000000000000000000000000000000000000000000000000000000c0"),
        );
        self.insert(
            &get_key(Some(3), &from_hex("0100000000")),
            &from_hex("a03546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685ae"),
        );
        self.insert(
            &get_key(Some(3), &from_hex("62657374")),
            &from_hex("3546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685ae"),
        );
        self.storage.insert(from_hex("f872a03dab320bf997adf800d55080d89425fbbffee284e8f6013028b0bba7381ff39fb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a020ab50d1e908c1146ab04f30430ab5244cd9896144fed21696bc5f73c87cc594b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f85180808080808080a08fdef6aabbaed7434a25718c43a70b0b6f5486b42ec8bf4c64eb5bb91ded328c80808080a0dfb8243034e61cc330852e972b909ecf3f643c1d136bf5d32f08ca4af988c46a80808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a02078deef11bd639a4ec02a05bd5b100b589d02671789ed1b95c4b2b5d5bddcd0b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a0208360fb40f4ba4917b00782e0138c35d184ebad53a2ef3a846b304cd67d9b91b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f851808080a01e286c78e19cde7a5a5dc0f0687f38e02c440e8647b03cf7c4c9d8d9a8e9f9c580a0667dec1e74ab0c0ab590d4986503c07668bdbb058d59a9feca52bdcccb21a8b68080808080808080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a03d96f773600b12e725160780e8e3fc8f49fe6786356af81999b0d862992e094fb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a02072cd96fb7a7cfeaf6caf7b8954d5cc9325ae0a4a475b9dbdb85d3c4f9736b1b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a03bb0a8965190f0cb8941429478b21bdb51a16037ac2937a3c87756a0a2a62e1fb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f873a0209da0425bcb8fbccca3757c4119bf48bed9980bc5ef60acfdc337bd4558d0abb850f84e808a152d02c7e14af6800000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a0316260489ab261235d262ff1bcbdd36f84f55e1c1f0665969ce764a2624a47e2b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a0202f29e338f08358568ca87b7f6d930642390ff65543e3e41c66b2250bbf3e78b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a03246c8b3e4dd83e1b08fd64c850d00eed059c4717876f54921371a44c94bd08eb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f851a0c707f2b1b2d76cdce3cb8acdee88c1f572aecb0bd6e7798f69742f60e3d78f20808080a06a2eb113c03875208af6626ec2d29e2a16157431de8fca5fe4eb117df63ad4a6808080808080808080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a03b954423083e6cc42ca247e8aeb14a9a29d8dce84ca59021b21ad8e487185e56b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a03fd6f25c0e1645272e340c6ef1f5704eac5ed890797b608e9c5df8e599ab1a8bb84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f9017180a0f286570926694b6dc09eb762652f1f44fe0e04b32132b23a6dfa0f7d3530d705a07004e0e9b45bc416e53899b9016e783dd3a2c225aee676f815f8990599b6a3a18080a0a3f933896d78cb7a35e6d94cae8b8ce265b7ba9c565ab059325c5157cd945a79a00b60c88dbeb2d37a2494ba7be322faf39a3ec40896078c93fe8af7ced965f680a0842b50a9a82ddeda0f7c752009cd1bcff92e70933258a0111be11d94ca456655a0acbcd136547f62ca23c5c1697714caf50829da7fa249ad57c48f608ef7072056a02af6304d6b8cb2cf2531873fd7518e3b0dce6819e9058b8bd8f580f07169e8a7a0f4e5cc055352d40af3dd3e0eeda7a4a475cbd67a629eade88aa37e7fddd269ffa0dede08c378b69b280070f118ecb7bdc656c05641320d05ae9e111ebbe3ee9809a003bef6bd21b96520ef69474a7b5b4a2b557b9b6f9d464cfaf332acf959b4426f80a08121aaeac0250c62b6cb1f841966b5af44662a7b1a931589dbef606d6dda34948080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a0355381f5fce2f3e495b70e316395fb7e2056198a8656a93470e02331c6faa2eab84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.insert(&get_key(Some(1), &from_hex("9a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526")), &from_hex("f901afa03546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685ae8102940000000000000000000000000000000000000000a05e880c219a1110b73b016b90fd13a5d95dedff59cf75f705ae6b19d23ed60ddfa0e263caddd50030068a585f13884344b59b94d19e007494e24c39d0d60f7d81cda036b38d32bc3eae475e051dda47c94f45b9f924f5fe4bb83aaf2b1206d023a396b901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080018401e848008301ed0e845bbc989280"));
        self.insert(&get_key(Some(2), &from_hex("9a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526")), &from_hex("f903b1f903adf903aa80843b9aca00836691b78080b90358608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506102f8806100606000396000f300608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630900f01014610067578063445df0ac146100aa5780638da5cb5b146100d5578063fdacd5761461012c575b600080fd5b34801561007357600080fd5b506100a8600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610159565b005b3480156100b657600080fd5b506100bf610241565b6040518082815260200191505060405180910390f35b3480156100e157600080fd5b506100ea610247565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561013857600080fd5b506101576004803603810190808035906020019092919050505061026c565b005b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561023d578190508073ffffffffffffffffffffffffffffffffffffffff1663fdacd5766001546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050600060405180830381600087803b15801561022457600080fd5b505af1158015610238573d6000803e3d6000fd5b505050505b5050565b60015481565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156102c957806001819055505b505600a165627a7a7230582030345ac4501e1f02e6574e06fe0a4f6287f3a062ee80ef55a9af2328379018e500291ca0f8423adbdd9614915860d68e7b771ee4c318b0f080a0ce7a170383958ea8169ea05bd6bd11b8ad37a1448eecfec4d544fbdd2f3256f1466d73655d979a3456d3bac0"));
        self.insert(&get_key(Some(3), &from_hex("049a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526")), &from_hex("f9010cf90109018301ed0eb9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0"));
        self.insert(
            &get_key(Some(3), &from_hex("62657374")),
            &from_hex("9a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("009a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526"),
            ),
            &from_hex(
                "e60180a03546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685aec001c0",
            ),
        );
        self.insert(&get_key(Some(3), &from_hex("003546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685ae")), &from_hex("f8458080a00000000000000000000000000000000000000000000000000000000000000000e1a09a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526"));
        self.insert(
            &get_key(Some(3), &from_hex("0100000001")),
            &from_hex("a09a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("02a2b3860d6cc64cf1688d3cca0c7b6126d11085ad592ead8439a65ccff31f09a1"),
            ),
            &from_hex("e2a09a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd952680"),
        );
        self.storage.insert(from_hex("f8689f34b11de1f0866c3ab1adf9aeadbc8d872a52fef21d4d035e122ef6fb1e87f5b846f8440180a01a2801fe3c59c6b43dd347b38f93aa079f590774dcf28e95016af8f3b11c029ca07b274e4822c05a41a30ec60b468fc6ea8c128e9c5ca8e8419c1c62e1fb37aaf0"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f8719f32cd96fb7a7cfeaf6caf7b8954d5cc9325ae0a4a475b9dbdb85d3c4f9736b1b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a03d96f773600b12e725160780e8e3fc8f49fe6786356af81999b0d862992e094fb84ff84d0189056bc6eb610996f400a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f9017180a0f286570926694b6dc09eb762652f1f44fe0e04b32132b23a6dfa0f7d3530d705a07004e0e9b45bc416e53899b9016e783dd3a2c225aee676f815f8990599b6a3a18080a09f4d037aa544ac24ea581b2c66fb9fb1c6dd12ee69d131212e358c5d8cfe11a9a03f95b4655a03867daeba74b8fb8dbd5acb008da6bc767be49b8f020dc1f7e940a0842b50a9a82ddeda0f7c752009cd1bcff92e70933258a0111be11d94ca456655a0acbcd136547f62ca23c5c1697714caf50829da7fa249ad57c48f608ef7072056a02af6304d6b8cb2cf2531873fd7518e3b0dce6819e9058b8bd8f580f07169e8a7a0f4e5cc055352d40af3dd3e0eeda7a4a475cbd67a629eade88aa37e7fddd269ffa0dede08c378b69b280070f118ecb7bdc656c05641320d05ae9e111ebbe3ee9809a003bef6bd21b96520ef69474a7b5b4a2b557b9b6f9d464cfaf332acf959b4426f80a01da9dc2d026a34b78c48efdc0936ea87b195f5504b04f0b1cfd2306f9130f3fe8080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f86fa02080c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312ab84cf84a808672cc59790c00a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.insert(&get_key(None, &from_hex("7b274e4822c05a41a30ec60b468fc6ea8c128e9c5ca8e8419c1c62e1fb37aaf0")), &from_hex("608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630900f01014610067578063445df0ac146100aa5780638da5cb5b146100d5578063fdacd5761461012c575b600080fd5b34801561007357600080fd5b506100a8600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610159565b005b3480156100b657600080fd5b506100bf610241565b6040518082815260200191505060405180910390f35b3480156100e157600080fd5b506100ea610247565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561013857600080fd5b506101576004803603810190808035906020019092919050505061026c565b005b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561023d578190508073ffffffffffffffffffffffffffffffffffffffff1663fdacd5766001546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050600060405180830381600087803b15801561022457600080fd5b505af1158015610238573d6000803e3d6000fd5b505050505b5050565b60015481565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156102c957806001819055505b505600a165627a7a7230582030345ac4501e1f02e6574e06fe0a4f6287f3a062ee80ef55a9af2328379018e50029"));
        self.storage.insert(from_hex("f872a020954423083e6cc42ca247e8aeb14a9a29d8dce84ca59021b21ad8e487185e56b84ff84d8089056bc75e2d63100000a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f838a120290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e56395941cca28600d7491365520b31b466f88647b9839ec"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f85180808080808080a08fdef6aabbaed7434a25718c43a70b0b6f5486b42ec8bf4c64eb5bb91ded328c80808080a0f5fb77a59eebc5abb7737cde46cff47caa1abd0edf2dd02fab10054836c0fd8c80808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f851808080a00891c3f48a6179d5540982ecbeb11b21d55ce8fc7b9d55a407cf0aed8ae4f72980808080808080a0512a2959160dcf6edeb31ba36ccec3b85ce42f52893fe1f7fd0d7cf9cecef4548080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f8518080808080a06ec6f3b85ed968de42b7a362003b1a274deb669e822ffe83b1e7ebc681ec9a7980a0fd714060209dbbafd866d49e4a4dee853d1464f6910b65e09cf7b74d21ac9700808080808080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.insert(&get_key(Some(1), &from_hex("613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc")), &from_hex("f901aea09a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd95268102940000000000000000000000000000000000000000a0c375b07391699e74d6033c931c86efccad08a0e27f3a185ccad08451be062db1a0a5347f1583972324ec5e24dca6e08c5dd04f3dcd174003dd7380dee334fa65cda05834bf566ed3a6417b53d443cd8372255e32169894ef8bfde24b52bd5cf5bc8fb901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080028401e8480082a418845bbc989280"));
        self.insert(&get_key(Some(2), &from_hex("613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc")), &from_hex("f88df88af88801843b9aca00836691b794f75d55dd51ee8756fbdb499cc1a963e702a5209180a4fdacd57600000000000000000000000000000000000000000000000000000000000000011ca0149f9fb7b99c9ae0e7a338b40aaafba0f90f7f60a16a9b5e768f945f4176d7f9a01e90cd984570c088dc57aa24498099df1bcc2a20789ecde4f5a085a8e242fefac0"));
        self.insert(&get_key(Some(3), &from_hex("04613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc")), &from_hex("f9010bf901080182a418b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0"));
        self.insert(
            &get_key(Some(3), &from_hex("62657374")),
            &from_hex("613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc"),
        );
        self.insert(&get_key(Some(3), &from_hex("009a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526")), &from_hex("f8470180a03546adf1c89e32acd11093f6f78468f5db413a207843aded872397821ea685aee1a0613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc01c0"));
        self.insert(
            &get_key(
                Some(3),
                &from_hex("00613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc"),
            ),
            &from_hex(
                "e60280a09a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526c001c0",
            ),
        );
        self.insert(
            &get_key(Some(3), &from_hex("0100000002")),
            &from_hex("a0613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("02245e865d5b574c34f89a2f18afabf704ef2d0a3296aee21673f187e410dcdb54"),
            ),
            &from_hex("e2a0613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc80"),
        );
        self.storage
            .insert(
                from_hex("e2a0310e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf601"),
                10,
                InsertOptions::default(),
            )
            .wait()
            .unwrap();
        self.storage.insert(from_hex("f872a03d96f773600b12e725160780e8e3fc8f49fe6786356af81999b0d862992e094fb84ff84d0289056bc6c52c49ac0400a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f85180808080808080a08fdef6aabbaed7434a25718c43a70b0b6f5486b42ec8bf4c64eb5bb91ded328c80808080a05d0b3c5b57431bf443a649d1997e094c80ee156e11564b2d5a3c2f29b9afb08480808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f9017180a0f286570926694b6dc09eb762652f1f44fe0e04b32132b23a6dfa0f7d3530d705a07004e0e9b45bc416e53899b9016e783dd3a2c225aee676f815f8990599b6a3a18080a067d4d20f94fa131d42602d88de139a13858534fb2e4e3d71d751ef3d73220c7aa018b1ded145771dece0d3f3e3639085058d5df0e6a2c1aeff29626bfdcd10b909a0842b50a9a82ddeda0f7c752009cd1bcff92e70933258a0111be11d94ca456655a0acbcd136547f62ca23c5c1697714caf50829da7fa249ad57c48f608ef7072056a02af6304d6b8cb2cf2531873fd7518e3b0dce6819e9058b8bd8f580f07169e8a7a0f4e5cc055352d40af3dd3e0eeda7a4a475cbd67a629eade88aa37e7fddd269ffa0dede08c378b69b280070f118ecb7bdc656c05641320d05ae9e111ebbe3ee9809a003bef6bd21b96520ef69474a7b5b4a2b557b9b6f9d464cfaf332acf959b4426f80a048f7799db9109bdf455f3292b36afa6cc9b219b9d238ab31c9a4e5bb2f55feb78080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f8689f34b11de1f0866c3ab1adf9aeadbc8d872a52fef21d4d035e122ef6fb1e87f5b846f8440180a0ea50606cd8e945e2cf0fa8624484592b098543e4a37e4719219bae7bf272c0cba07b274e4822c05a41a30ec60b468fc6ea8c128e9c5ca8e8419c1c62e1fb37aaf0"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f851808080a01cc5fc08fa97c2f2b54389e2bff7b7574cfbe74de73a4ab43d20f904dc3fbfe880808080808080a0512a2959160dcf6edeb31ba36ccec3b85ce42f52893fe1f7fd0d7cf9cecef4548080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f86fa02080c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312ab84cf84a808699011963fc00a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f7a0390decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e56395941cca28600d7491365520b31b466f88647b9839ec"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f8518080808080a0abb5de64b57aebc46b39841bbb2994d91f9d7ea0f1c7ee6f3d2fbfcc73c5005180a0fd714060209dbbafd866d49e4a4dee853d1464f6910b65e09cf7b74d21ac9700808080808080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f8518080a06689c3915ed2c2d3295017727a643f21fd7e5d7863a08d389f978e3e807495e78080808080808080a0c0b795053e2a67c31eae717312c3debccdba06255970349352bb015a7acc4b328080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.insert(&get_key(Some(1), &from_hex("75be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e")), &from_hex("f901afa0613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc8102940000000000000000000000000000000000000000a02377409f9d5d290c56998cc9117e0463c873f35e3b422c762afaf5c38e5bbb02a0c252de7b321bac296ab5549588fa52b718f5097ae0904670ce78e221a0ea0a4fa0c1bf70ecee258fb78ebdd0cf683f04333592dc804374733860c1fe3162fceb4eb901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080038401e84800830106c1845bbc989780"));
        self.insert(&get_key(Some(2), &from_hex("75be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e")), &from_hex("f9014af90146f9014302843b9aca00836691b78080b8f26080604052348015600f57600080fd5b5060d48061001e6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680634d43bec9146044575b600080fd5b348015604f57600080fd5b50606c60048036038101908080359060200190929190505050606e565b005b7f6c2b4666ba8da5a95717621d879a77de725f3d816709b9cbe9f059b8f875e284816040518082815260200191505060405180910390a1505600a165627a7a72305820a5b279645773e5659f8cf96cbb92f57e889b47a336d976ec5eeba94b1a6f0aa000291ca08c2b067b2229de69d44423d7f7ea6bf5f595d38f432bf0ff7ce561284ba07633a05c1e6867424dc8628e1c45128f7bb59f7fb533910fe1d4108b6ef42c0cb1074ac0"));
        self.insert(&get_key(Some(3), &from_hex("0475be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e")), &from_hex("f9010cf9010901830106c1b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0"));
        self.insert(
            &get_key(Some(3), &from_hex("62657374")),
            &from_hex("75be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("0075be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e"),
            ),
            &from_hex(
                "e60380a0613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffcc001c0",
            ),
        );
        self.insert(&get_key(Some(3), &from_hex("00613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffc")), &from_hex("f8470280a09a4ffe2733a837c80d0b7e2fd63b838806e3b8294dab3ad86249619b28fd9526e1a075be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e01c0"));
        self.insert(
            &get_key(Some(3), &from_hex("0100000003")),
            &from_hex("a075be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("024427bf528be3b1d33aac5fcb4e113ac04c7b54acbfd13faf8b7a0f550b21caa1"),
            ),
            &from_hex("e2a075be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e80"),
        );
        self.storage.insert(from_hex("f872a03d96f773600b12e725160780e8e3fc8f49fe6786356af81999b0d862992e094fb84ff84d0389056bc687feef3dba00a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f851808080a052061c7bd84b54d87ae003fc5e97f236d18568aab54bf5f15fcbedd1b8f0b58080808080808080a0512a2959160dcf6edeb31ba36ccec3b85ce42f52893fe1f7fd0d7cf9cecef4548080808080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f86fa02080c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312ab84cf84a8086d62e73d24600a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f869a036ebbd59a3c513e43e28d73da24d8610604c6790d63adbc58b8225e56faf3cb2b846f8440180a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a086351505023ebc83b4013840d0650d52b3f3b9ec6df3f7d3b6a802a96209dfd2"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f9019180a0f286570926694b6dc09eb762652f1f44fe0e04b32132b23a6dfa0f7d3530d705a07004e0e9b45bc416e53899b9016e783dd3a2c225aee676f815f8990599b6a3a18080a06faf11b019ec587c47532fb213cb687ca5aeb270cf4e06b4e8f2b3ae89ac77c8a018b1ded145771dece0d3f3e3639085058d5df0e6a2c1aeff29626bfdcd10b909a0842b50a9a82ddeda0f7c752009cd1bcff92e70933258a0111be11d94ca456655a0acbcd136547f62ca23c5c1697714caf50829da7fa249ad57c48f608ef7072056a02af6304d6b8cb2cf2531873fd7518e3b0dce6819e9058b8bd8f580f07169e8a7a0f4e5cc055352d40af3dd3e0eeda7a4a475cbd67a629eade88aa37e7fddd269ffa0dede08c378b69b280070f118ecb7bdc656c05641320d05ae9e111ebbe3ee9809a003bef6bd21b96520ef69474a7b5b4a2b557b9b6f9d464cfaf332acf959b4426fa068cb41848b222bf2cc904c861efef921d48587f144da772c12f9729f7b3b6c30a0274dfb8e6c7957c77fc25f1ec549022ad48f9223540c0db62f3bb86142d431548080"), 10, InsertOptions::default()).wait().unwrap();
        self.insert(&get_key(None, &from_hex("86351505023ebc83b4013840d0650d52b3f3b9ec6df3f7d3b6a802a96209dfd2")), &from_hex("608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680634d43bec9146044575b600080fd5b348015604f57600080fd5b50606c60048036038101908080359060200190929190505050606e565b005b7f6c2b4666ba8da5a95717621d879a77de725f3d816709b9cbe9f059b8f875e284816040518082815260200191505060405180910390a1505600a165627a7a72305820a5b279645773e5659f8cf96cbb92f57e889b47a336d976ec5eeba94b1a6f0aa00029"));
        self.insert(&get_key(Some(1), &from_hex("832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c118")), &from_hex("f901aea075be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e8102940000000000000000000000000000000000000000a0547c9b6ae528210c50932815f523fa65a96db4c16104fd329167f81936a2e3dda0fb853c40ff08f49559e2dfc7a0b28707b7b27ebd7d8d8d9b7fb2dac5cf860823a031560c52c27b7a69aa56e681268466a85bd942d18b61bda636570dc6d68908ceb901000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080048401e848008258c2845bbc989780"));
        self.insert(&get_key(Some(2), &from_hex("832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c118")), &from_hex("f88df88af88803843b9aca00836691b794fbe2ab6ee22dace9e2ca1cb42c57bf94a32ddd4180a44d43bec9000000000000000000000000000000000000000000000000000000000000007b1ca0a60d2e2bd1cbb4d92e4b6edf17685552cf338d788e6aa4fc72059b408c41fa51a01db11adf1684acdb6782d011882f7b04db1aaed6894f5d55fdcc1ffee9305813c0"));
        self.insert(&get_key(Some(3), &from_hex("04832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c118")), &from_hex("f90166f90163018258c2b9010000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f85af85894fbe2ab6ee22dace9e2ca1cb42c57bf94a32ddd41e1a06c2b4666ba8da5a95717621d879a77de725f3d816709b9cbe9f059b8f875e284a0000000000000000000000000000000000000000000000000000000000000007b"));
        self.insert(&get_key(Some(3), &from_hex("030200000000")), &from_hex("f91030b9010000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(&get_key(Some(3), &from_hex("030000000000")), &from_hex("f91030b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(&get_key(Some(3), &from_hex("030100000000")), &from_hex("f91030b9010000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"));
        self.insert(
            &get_key(Some(3), &from_hex("62657374")),
            &from_hex("832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c118"),
        );
        self.insert(&get_key(Some(3), &from_hex("0075be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56e")), &from_hex("f8470380a0613afac8fd33fd7a35b8928e68f6abc031ca8e16c35caa2eaa7518c4e753cffce1a0832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c11801c0"));
        self.insert(
            &get_key(
                Some(3),
                &from_hex("00832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c118"),
            ),
            &from_hex(
                "e60480a075be890ab64005e4239cfc257349c536fdde555a211c663b9235abb2ec21e56ec001c0",
            ),
        );
        self.insert(
            &get_key(Some(3), &from_hex("0100000004")),
            &from_hex("a0832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c118"),
        );
        self.insert(
            &get_key(
                Some(3),
                &from_hex("0213519e194348f7492afa783639c35185d3e81015c6aa19d5598b4a5de08eec9f"),
            ),
            &from_hex("e2a0832e166d73a1baddb00d65de04086616548e3c96b0aaf0f9fe1939e29868c11880"),
        );
        self.storage.insert(from_hex("f86fa02080c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312ab84cf84a8086ead8d48f5a00a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f872a03d96f773600b12e725160780e8e3fc8f49fe6786356af81999b0d862992e094fb84ff84d0489056bc673548e80a600a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f9019180a0f286570926694b6dc09eb762652f1f44fe0e04b32132b23a6dfa0f7d3530d705a07004e0e9b45bc416e53899b9016e783dd3a2c225aee676f815f8990599b6a3a18080a0f2e41d7d28cc2a4f8900f11c35665ef1bf9c7c6139c01a39aea859069bf21a08a018b1ded145771dece0d3f3e3639085058d5df0e6a2c1aeff29626bfdcd10b909a0842b50a9a82ddeda0f7c752009cd1bcff92e70933258a0111be11d94ca456655a0acbcd136547f62ca23c5c1697714caf50829da7fa249ad57c48f608ef7072056a02af6304d6b8cb2cf2531873fd7518e3b0dce6819e9058b8bd8f580f07169e8a7a0f4e5cc055352d40af3dd3e0eeda7a4a475cbd67a629eade88aa37e7fddd269ffa0dede08c378b69b280070f118ecb7bdc656c05641320d05ae9e111ebbe3ee9809a003bef6bd21b96520ef69474a7b5b4a2b557b9b6f9d464cfaf332acf959b4426fa068cb41848b222bf2cc904c861efef921d48587f144da772c12f9729f7b3b6c30a0490364b043182e36a048637bb10ca4ab9cc060d2438d5714eab47eb60e4479b28080"), 10, InsertOptions::default()).wait().unwrap();
        self.storage.insert(from_hex("f851808080a0e9c85ce170ecefc5c7951f32a74ef402a0a8820c2fd798b5cfeba963377bb32f80808080808080a0512a2959160dcf6edeb31ba36ccec3b85ce42f52893fe1f7fd0d7cf9cecef4548080808080"), 10, InsertOptions::default()).wait().unwrap();
    }
}

impl Database for MockDb {
    fn contains_key(&self, key: &[u8]) -> bool {
        self.map.contains_key(key)
    }

    fn get(&self, key: &[u8]) -> Option<Vec<u8>> {
        self.map.get(key).cloned()
    }

    fn insert(&mut self, key: &[u8], value: &[u8]) -> Option<Vec<u8>> {
        self.map.insert(key.to_vec(), value.to_vec())
    }

    fn remove(&mut self, key: &[u8]) -> Option<Vec<u8>> {
        self.map.remove(key)
    }

    fn set_root_hash(&mut self, _root_hash: H256) -> Result<()> {
        unimplemented!();
    }

    fn get_root_hash(&self) -> H256 {
        unimplemented!();
    }

    fn commit(&mut self) -> Result<H256> {
        unimplemented!();
    }

    fn rollback(&mut self) {
        self.map.clear()
    }

    fn with_encryption<F, R>(&mut self, _contract_id: H256, _f: F) -> R
    where
        F: FnOnce(&mut DatabaseHandle) -> R,
    {
        unimplemented!();
    }

    fn with_encryption_key<F, R>(&mut self, key: StateKeyType, _f: F) -> R
    where
        F: FnOnce(&mut DatabaseHandle) -> R,
    {
        unimplemented!();
    }
}
